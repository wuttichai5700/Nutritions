<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Kanit', sans-serif;
      background: linear-gradient(to bottom, #dff2ff, #eef7fb);
      padding: 40px;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: #ffffff;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    h2 {
      text-align: center;
      color: #1a5276;
    }
    canvas {
      margin: 20px auto;
      display: block;
      max-width: 500px;
    }
    select, button, input[type=number] {
      padding: 10px;
      font-size: 1rem;
      margin: 5px 5px 5px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      transition: background-color 0.3s ease;
      font-family: 'Kanit', sans-serif;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ccc;
    }
    th {
      background-color: #3498db;
      color: white;
    }
    tfoot td {
      font-weight: bold;
      background: #ecf0f1;
    }
    td button {
      background-color: #e74c3c;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }
    td button:hover {
      background-color: #c0392b;
    }
    #logo {
      display: block;
      margin: 0 auto 20px;
      max-width: 120px;
    }
    .warning {
      margin-top: 20px;
      padding: 15px;
      background: #fff3cd;
      border-left: 5px solid #ffc107;
      color: #856404;
      border-radius: 8px;
    }
    .goal-setting {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }
    .goal-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

.goal-row label {
  font-weight: bold;
  min-width: 230px; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ label ‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô */
}

.goal-row input[type="number"] {
  width: 120px;
}

.goal-row button {
  min-width: 80px;
}

.goal-feedback {
  min-width: 100px;
  color: green;
}

    @media print {
      label, select, button, td:last-child, th:last-child, .sodium-setting, .goal-setting { display: none !important; }
    }
    .center-button {
      display: flex;
      justify-content: center;
      margin-top: 30px;
      width: 100%;
    }
    .bar-container {
  background-color: #ecf0f1;
  border-radius: 20px;
  overflow: hidden;
  height: 28px;
  margin-bottom: 15px;
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
}

.bar-fill {
  height: 100%;
  line-height: 28px;
  text-align: right;
  padding-right: 12px;
  font-weight: bold;
  color: white;
  border-radius: 20px;
  transition: width 0.6s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

  </style>
  <style>
  @media screen and (max-width: 768px) {
    .goal-setting {
      gap: 10px;
    }
    .goal-row {
      flex-direction: column;
      align-items: flex-start;
    }
    .goal-row label {
      min-width: auto;
      width: 100%;
    }
    .goal-row input[type="number"],
    .goal-row button,
    .goal-feedback {
      width: 100%;
      margin-top: 5px;
    }
    .goal-feedback {
      text-align: left;
    }
    .bar-container {
      height: 24px;
    }
    canvas {
      max-width: 100% !important;
    }
    table {
      font-size: 0.9rem;
      display: block;
      overflow-x: auto;
      white-space: nowrap;
    }
    th, td {
      padding: 6px;
    }
    .center-button button {
      width: 100%;
      font-size: 1rem;
      padding: 10px;
    }
  }
</style>

</head>
<body>
  
  <div class="container" id="pdfContent">
    <!-- ... existing content ... -->
     <div  id="pdfContent">
    <img src="images/logo.png" alt="Logo" style="max-width:150px; display:block; margin: 0 auto;">

    

    <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
</div>
    <div class="goal-setting">
      <div class="goal-row">
        <label for="goalCarb">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Carb (g):</label>
        <input type="number" id="goalCarb" value="300">
        <button onclick="saveGoal('Carb')">‚úîÔ∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        <span id="statusCarb" class="goal-feedback success"></span>
      </div>
      <div class="goal-row">
        <label for="goalProtein">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Protein (g):</label>
        <input type="number" id="goalProtein" value="150">
        <button onclick="saveGoal('Protein')">‚úîÔ∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        <span id="statusProtein" class="goal-feedback success"></span>
      </div>
      <div class="goal-row">
        <label for="goalFat">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Fat (g):</label>
        <input type="number" id="goalFat" value="70">
        <button onclick="saveGoal('Fat')">‚úîÔ∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        <span id="statusFat" class="goal-feedback success"></span>
      </div>
       <div class="sodium-setting goal-row">
      <label for="sodiumLimit">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÇ‡∏ã‡πÄ‡∏î‡∏µ‡∏¢‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (mg):</label>
      <input type="number" id="sodiumLimit" value="2000">
      <button onclick="saveSodiumLimit()">‚úîÔ∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
      <span id="statusSodium" class="goal-feedback success"></span>
    </div>
      <div class="goal-row">
        <label for="goalCalorie">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Calories (kcal):</label>
        <input type="number" id="goalCalorie" value="2000">
        <button onclick="saveGoal('Calorie')">‚úîÔ∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        <span id="statusCalorie" class="goal-feedback success"></span>
      </div>
    </div>
   
<div style="text-align: right; margin-top: 10px;">
      <button onclick="resetAllData()" style="background-color: #e74c3c; padding: 8px 16px; border-radius: 6px;">üîÑ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
    <div id="progressBars" class="container" ></div>
<br><br>
    

    <label for="mealTime">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏∑‡πâ‡∏≠:</label>
    <select id="mealTime">
      <option value="‡πÄ‡∏ä‡πâ‡∏≤">‡πÄ‡∏ä‡πâ‡∏≤</option>
      <option value="‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á">‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á</option>
      <option value="‡πÄ‡∏¢‡πá‡∏ô">‡πÄ‡∏¢‡πá‡∏ô</option>
      <option value="‡∏î‡∏∂‡∏Å">‡∏î‡∏∂‡∏Å</option>
    </select>
    <label for="menuDropdown">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π:</label>
    <select id="menuDropdown">
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π --</option>
      <option value="‡∏™‡∏∏‡∏Å‡∏µ‡πâ‡∏≠‡∏Å‡πÑ‡∏Å‡πà">‡∏™‡∏∏‡∏Å‡∏µ‡πâ‡∏≠‡∏Å‡πÑ‡∏Å‡πà</option>
      <option value="‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∏‡πâ‡∏á">‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∏‡πâ‡∏á</option>
      <option value="‡∏≠‡∏Å‡πÑ‡∏Å‡πà + ‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°">‡∏≠‡∏Å‡πÑ‡∏Å‡πà + ‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°</option>
      <option value="‡πÄ‡∏°‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏•‡∏≤‡∏ó‡∏π">‡πÄ‡∏°‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏•‡∏≤‡∏ó‡∏π</option>
      <option value="‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏≠‡∏Å‡πÑ‡∏Å‡πà">‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏≠‡∏Å‡πÑ‡∏Å‡πà</option>
      <option value="‡∏≠‡∏Å‡πÑ‡∏Å‡πà‡∏ú‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏´‡∏•‡πà‡∏≥">‡∏≠‡∏Å‡πÑ‡∏Å‡πà‡∏ú‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏´‡∏•‡πà‡∏≥</option>
      <option value="‡∏¢‡∏≥‡∏≠‡∏Å‡πÑ‡∏Å‡πà‡∏ú‡∏±‡∏Å‡∏£‡∏ß‡∏°">‡∏¢‡∏≥‡∏≠‡∏Å‡πÑ‡∏Å‡πà‡∏ú‡∏±‡∏Å‡∏£‡∏ß‡∏°</option>
      <option value="‡∏≠‡∏Å‡πÑ‡∏Å‡πà + ‡∏Å‡∏•‡πâ‡∏ß‡∏¢">‡∏≠‡∏Å‡πÑ‡∏Å‡πà + ‡∏Å‡∏•‡πâ‡∏ß‡∏¢</option>
      <option value="‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°">‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°</option>
      <option value="‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏≠‡∏Å‡πÑ‡∏Å‡πà">‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏≠‡∏Å‡πÑ‡∏Å‡πà</option>
      <option value="‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡∏´‡∏≠‡∏°">‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡∏´‡∏≠‡∏°</option>
      <option value="‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÇ‡∏≠‡∏£‡∏µ‡πÇ‡∏≠ 3 ‡πÅ‡∏ú‡πà‡∏ô">‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÇ‡∏≠‡∏£‡∏µ‡πÇ‡∏≠ 3 ‡πÅ‡∏ú‡πà‡∏ô</option>
      <option value="‡∏¢‡∏≥‡∏≠‡∏Å‡πÑ‡∏Å‡πà">‡∏¢‡∏≥‡∏≠‡∏Å‡πÑ‡∏Å‡πà</option>
      <option value="‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤‡∏´‡∏π‡πâ">‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤‡∏´‡∏π‡πâ</option>
    </select>

    <button onclick="addSelectedMenu()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</button>
    <button onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
    <button onclick="downloadPDF()">üìÑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF</button>

    <div id="mealTables"></div>
    <div class="warning" id="alerts"></div>
  </div>

  <script>
   const menuData = {"‡∏™‡∏∏‡∏Å‡∏µ‡πâ‡∏≠‡∏Å‡πÑ‡∏Å‡πà": { carb: 44.2, protein: 64, fat: 21.1, sodium: 771, cal: 607 },
      "‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∏‡πâ‡∏á": { carb: 59.4, protein: 47.4, fat: 17.0, sodium: 686, cal: 715 },
      "‡∏≠‡∏Å‡πÑ‡∏Å‡πà + ‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°": { carb: 2, protein: 44, fat: 5.5, sodium: 780, cal: 270 },
      "‡πÄ‡∏°‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏•‡∏≤‡∏ó‡∏π": { carb: 86.8, protein: 77.6, fat: 16.0, sodium: 1020, cal: 860 },
      "‡∏•‡∏π‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏≠‡∏Å‡πÑ‡∏Å‡πà": { carb: 0, protein: 66, fat: 7.5, sodium: 635, cal: 390 },
      "‡∏≠‡∏Å‡πÑ‡∏Å‡πà‡∏ú‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏´‡∏•‡πà‡∏≥": { carb: 30, protein: 32.1, fat: 10.0, sodium: 1011, cal: 339 },
      "‡∏¢‡∏≥‡∏≠‡∏Å‡πÑ‡∏Å‡πà‡∏ú‡∏±‡∏Å‡∏£‡∏ß‡∏°": { carb: 73.2, protein: 27.0, fat: 21.6, sodium: 265, cal: 585 },
      "‡∏≠‡∏Å‡πÑ‡∏Å‡πà + ‡∏Å‡∏•‡πâ‡∏ß‡∏¢": { carb: 8, protein: 44.0, fat: 5.2, sodium: 580, cal: 315 },
      "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏°": { carb: 55, protein: 55, fat: 23.5, sodium: 585, cal: 700 },
      "‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏≠‡∏Å‡πÑ‡∏Å‡πà": { carb: 76, protein: 86.8, fat: 20.4, sodium: 780, cal: 943 },
      "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÇ‡∏≠‡∏£‡∏µ‡πÇ‡∏≠ 3 ‡πÅ‡∏ú‡πà‡∏ô": { carb: 22, protein: 6, fat: 2, sodium: 280, cal: 140 },
      "‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡∏´‡∏≠‡∏°": { carb: 32, protein: 0, fat: 0.5, sodium: 0, cal: 132 },
      "‡∏¢‡∏≥‡∏≠‡∏Å‡πÑ‡∏Å‡πà": { carb: 0, protein: 44, fat: 6, sodium: 400, cal: 270 },
      "‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤‡∏´‡∏π‡πâ": { carb: 12, protein: 8, fat: 4, sodium: 0, cal: 120 }};; // Add menu nutrition data here
     let meals = JSON.parse(localStorage.getItem("meals")) || { "‡πÄ‡∏ä‡πâ‡∏≤": [], "‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á": [], "‡πÄ‡∏¢‡πá‡∏ô": [], "‡∏î‡∏∂‡∏Å": [] };

    function saveGoal(nutrient) {
      const id = `goal${nutrient}`;
      const value = parseInt(document.getElementById(id).value) || 0;
      localStorage.setItem(nutrient.toLowerCase() + 'Goal', value);

      if (nutrient === 'Carb') carbGoal = value;
      if (nutrient === 'Protein') proteinGoal = value;
      if (nutrient === 'Fat') fatGoal = value;
      if (nutrient === 'Calorie') calGoal = value;

      document.getElementById('status' + nutrient).innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
      renderTables();
    }

    function saveSodiumLimit() {
      sodiumLimit = parseInt(document.getElementById("sodiumLimit").value) || 2000;
      localStorage.setItem("sodiumLimit", sodiumLimit);
      document.getElementById("statusSodium").innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
      renderTables();
    }

    function addSelectedMenu() {
      const menu = document.getElementById('menuDropdown').value;
      const meal = document.getElementById('mealTime').value;
      if (menu && !meals[meal].includes(menu)) {
        meals[meal].push(menu);
        localStorage.setItem("meals", JSON.stringify(meals));
        renderTables();
      }
    }

    function removeMenu(meal, item) {
      meals[meal] = meals[meal].filter(name => name !== item);
      localStorage.setItem("meals", JSON.stringify(meals));
      renderTables();
    }
     function resetAllData() {
      localStorage.clear();
      location.reload();
    }
    function resetAllData() {
     const confirmClear = confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?");
     if (confirmClear) {
    localStorage.clear();
    location.reload();
      }
      }

    window.onload = function() {
      renderTables();
    }

    function renderTables() {
      const container = document.getElementById('mealTables');
      container.innerHTML = '';
      let total = { carb: 0, protein: 0, fat: 0, sodium: 0, cal: 0 };

      for (const meal in meals) {
        if (meals[meal].length === 0) continue;
        const table = document.createElement('table');
        const header = `<h3>‡∏°‡∏∑‡πâ‡∏≠${meal}</h3>`;
        table.innerHTML = `
          <thead><tr><th>‡πÄ‡∏°‡∏ô‡∏π</th><th>Carb</th><th>Protein</th><th>Fat</th><th>Sodium</th><th>Calories</th><th>‡∏•‡∏ö</th></tr></thead>
          <tbody>${meals[meal].map(name => {
            const d = menuData[name] || {carb:0, protein:0, fat:0, sodium:0, cal:0};
            total.carb += d.carb; total.protein += d.protein; total.fat += d.fat;
            total.sodium += d.sodium; total.cal += d.cal;
            return `<tr><td>${name}</td><td>${d.carb}</td><td>${d.protein}</td><td>${d.fat}</td><td>${d.sodium}</td><td>${d.cal}</td><td><button onclick="removeMenu('${meal}','${name}')">‚ùå</button></td></tr>`
          }).join('')}</tbody>`;
        container.innerHTML += header;
        container.appendChild(table);
      }

      const warnBox = document.getElementById('alerts');
      let alerts = [];
      if (total.sodium > sodiumLimit) alerts.push(`‡πÇ‡∏ã‡πÄ‡∏î‡∏µ‡∏¢‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô ${sodiumLimit}mg`);
      if (total.carb > carbGoal) alerts.push(`Carb ‡πÄ‡∏Å‡∏¥‡∏ô ${carbGoal}g`);
      if (total.protein > proteinGoal) alerts.push(`Protein ‡πÄ‡∏Å‡∏¥‡∏ô ${proteinGoal}g`);
      if (total.fat > fatGoal) alerts.push(`Fat ‡πÄ‡∏Å‡∏¥‡∏ô ${fatGoal}g`);
      warnBox.innerHTML = alerts.length ? `‚ö†Ô∏è ${alerts.join(' | ')}` : '';
    }

    function downloadPDF() {
      const element = document.getElementById('pdfContent');
      const opt = {
        margin: 0.5,
        filename: 'nutrition-summary.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }

function saveGoal(nutrient) {
  const id = `goal${nutrient}`;
  const value = parseInt(document.getElementById(id).value) || 0;
  localStorage.setItem(nutrient.toLowerCase() + 'Goal', value);

  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global
  if (nutrient === 'Carb') carbGoal = value;
  if (nutrient === 'Protein') proteinGoal = value;
  if (nutrient === 'Fat') fatGoal = value;

  // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
  document.getElementById('status' + nutrient).innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
  alert(`${nutrient} ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡πá‡∏ô ${value}`);
  renderTables();
}

function saveSodiumLimit() {
  sodiumLimit = parseInt(document.getElementById("sodiumLimit").value) || 2000;
  localStorage.setItem("sodiumLimit", sodiumLimit);
  document.getElementById("statusSodium").innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
  alert(`Sodium ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡πá‡∏ô ${sodiumLimit}`);
  renderTables();
}


  </script>
 <br>

  <div class="container">
    <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
    <canvas id="nutritionChart"></canvas>
    <p id="totalCalories" style="text-align:center; font-weight:bold; font-size:1.2rem; margin-top:10px;"></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script>
    let nutritionChart;
     
  
    let calGoal = parseInt(localStorage.getItem("calorieGoal")) || 2000;
    let carbGoal = parseInt(localStorage.getItem("carbGoal")) || 300;
    let proteinGoal = parseInt(localStorage.getItem("proteinGoal")) || 150;
    let fatGoal = parseInt(localStorage.getItem("fatGoal")) || 70;
    let sodiumLimit = parseInt(localStorage.getItem("sodiumLimit")) || 2000;

    document.getElementById("goalCalorie").value = calGoal;
    document.getElementById("goalCarb").value = carbGoal;
    document.getElementById("goalProtein").value = proteinGoal;
    document.getElementById("goalFat").value = fatGoal;
    document.getElementById("sodiumLimit").value = sodiumLimit;

    function saveGoal(nutrient) {
      const id = `goal${nutrient}`;
      const value = parseInt(document.getElementById(id).value) || 0;
      localStorage.setItem(nutrient.toLowerCase() + 'Goal', value);

      if (nutrient === 'Carb') carbGoal = value;
      if (nutrient === 'Protein') proteinGoal = value;
      if (nutrient === 'Fat') fatGoal = value;
      if (nutrient === 'Calorie') calGoal = value;

      document.getElementById('status' + nutrient).innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
      alert(`${nutrient} ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡πá‡∏ô ${value}`);
      renderTables();
    }

    function updateProgressBars(total) {
  const barsHTML = ['Carb', 'Protein', 'Fat'].map((key, i) => {
    const current = total[key.toLowerCase()] || 0;
    const goal = [carbGoal, proteinGoal, fatGoal][i];
    const percent = goal ? Math.min(100, Math.round((current / goal) * 100)) : 0;

    const gradients = [
      'linear-gradient(to right, #f9d423, #f39c12)',   // Carb
      'linear-gradient(to right, #43e97b, #38f9d7)',   // Protein
      'linear-gradient(to right, #f7971e, #e67e22)'    // Fat
    ];

    return `
      <div style="margin-bottom: 5px;"><strong>${key}</strong></div>
      <div class="bar-container">
        <div class="bar-fill" style="width: ${percent}%; background: ${gradients[i]};">
          ${percent}%
        </div>
      </div>
    `;
  }).join('');

  document.getElementById("progressBars").innerHTML = `
    <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ</h3>
    ${barsHTML}
  `;
}


    function updateChart(totalCarb, totalProtein, totalFat, totalCal) {
      const ctx = document.getElementById('nutritionChart').getContext('2d');
      const data = {
        labels: ['Carb', 'Protein', 'Fat'],
        datasets: [{
          data: [totalCarb, totalProtein, totalFat],
          backgroundColor: ['#f39c12', '#27ae60', '#e67e22']
        }]
      };

      const options = {
  responsive: true,
  plugins: {
    legend: { position: 'bottom' },
    title: { display: true, text: 'Graph For Nutrations' },
    datalabels: {
      color: '#fff',
      formatter: (value) => `${value.toFixed(1)}g`,  // <== ‡∏õ‡∏±‡∏î‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 1 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
      font: { weight: 'bold' }
    }
  }
};


      if (nutritionChart) {
        nutritionChart.data.datasets[0].data = [totalCarb, totalProtein, totalFat];
        nutritionChart.update();
      } else {
        nutritionChart = new Chart(ctx, {
          type: 'pie',
          data,
          options,
          plugins: [ChartDataLabels]
        });
      }
      document.getElementById('totalCalories').innerText = `‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°: ${totalCal} kcal (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${calGoal} kcal)`;
    }

    function renderTables() {
      const container = document.getElementById('mealTables');
      container.innerHTML = '';
      let total = { carb: 0, protein: 0, fat: 0, sodium: 0, cal: 0 };

      for (const meal in meals) {
        if (meals[meal].length === 0) continue;
        const table = document.createElement('table');
        const header = `<h3>‡∏°‡∏∑‡πâ‡∏≠${meal}</h3>`;
        table.innerHTML = `
          <thead><tr><th>‡πÄ‡∏°‡∏ô‡∏π</th><th>Carb</th><th>Protein</th><th>Fat</th><th>Sodium</th><th>Calories</th><th>‡∏•‡∏ö</th></tr></thead>
          <tbody>${meals[meal].map(name => {
            const d = menuData[name] || {carb:0, protein:0, fat:0, sodium:0, cal:0};
            total.carb += d.carb; total.protein += d.protein; total.fat += d.fat;
            total.sodium += d.sodium; total.cal += d.cal;
            return `<tr><td>${name}</td><td>${d.carb}</td><td>${d.protein}</td><td>${d.fat}</td><td>${d.sodium}</td><td>${d.cal}</td><td><button onclick="removeMenu('${meal}','${name}')">‚ùå</button></td></tr>`
          }).join('')}</tbody>`;
        container.innerHTML += header;
        container.appendChild(table);
      }

      const warnBox = document.getElementById('alerts');
      let alerts = [];
      if (total.sodium > sodiumLimit) alerts.push(`‡πÇ‡∏ã‡πÄ‡∏î‡∏µ‡∏¢‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô ${sodiumLimit}mg (+${total.sodium - sodiumLimit}mg)`);
      if (total.carb > carbGoal) alerts.push(`Carb ‡πÄ‡∏Å‡∏¥‡∏ô ${carbGoal}g (+${(total.carb - carbGoal).toFixed(1)}g)`);
      if (total.protein > proteinGoal) alerts.push(`Protein ‡πÄ‡∏Å‡∏¥‡∏ô ${proteinGoal}g (+${(total.protein - proteinGoal).toFixed(1)}g)`);
      if (total.fat > fatGoal) alerts.push(`Fat ‡πÄ‡∏Å‡∏¥‡∏ô ${fatGoal}g (+${(total.fat - fatGoal).toFixed(1)}g)`);
      if (total.cal > calGoal) alerts.push(`Calories ‡πÄ‡∏Å‡∏¥‡∏ô ${calGoal}kcal (+${(total.cal - calGoal).toFixed(1)}kcal)`);
      warnBox.innerHTML = alerts.length ? `‚ö†Ô∏è ${alerts.join(' | ')}` : '';

      updateChart(total.carb, total.protein, total.fat, total.cal);
      updateProgressBars(total);
    }
  </script>
  <body>
  <div class="center-button">
    <a href="index.html">
      <button style="padding: 12px 24px; font-size: 16px; background-color: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-family: 'Kanit', sans-serif;">
        üëà ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
      </button>
    </a>
  </div>
</body>
</body>
</html>
